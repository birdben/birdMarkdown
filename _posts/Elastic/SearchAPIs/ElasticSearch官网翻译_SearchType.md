---
title: "ElasticSearch官网翻译_SearchType"
date: 2017-05-26 00:02:56
tags: [Elasticsearch]
categories: [Search]
---

#### Search Type

<b>
执行分布式搜索时可以执行不同的执行路径。分布式搜索操作需要分散到所有相关的分片中，然后将所有结果都收集回来。在执行分散/收集类型时，有几种方法可以实现，特别是搜索引擎。

执行分布式搜索时的其中一个问题是从每个分片中取回多少结果。例如，如果我们有10个分片，则第一个分片可能会保持从0到10的最相关的结果，其他分片结果排在下面。因此，当执行请求时，我们将需要从所有分片中获取0到10的结果，对它们进行排序，然后如果要确保正确的结果，则返回结果。

与搜索引擎有关的另一个问题是每个碎片都是自己的。当在特定分片上执行查询时，它不会考虑来自其他分片的词条频率和其他搜索引擎信息。如果我们要支持准确的排名，我们需要首先从所有分片收集词条频率，以计算全局词条频率，然后使用这些全局频率对每个分片执行查询。

另外，由于需要对结果进行排序，返回一个大的文档集，甚至滚动它，因此在保持正确的排序行为可能是非常昂贵的操作。对于大型结果集滚动，如果返回文档的顺序并不重要，最好按_doc进行排序。

Elasticsearch非常灵活，可以根据搜索请求来控制搜索的类型。可以通过在query string中设置search_type参数来配置类型。类型是：
</b>

##### Query Then Fetch（查询然后获取）

参数值：query_then_fetch。

<b>
请求分两个阶段进行处理。 在第一阶段，查询转发到所有相关的分片。 每个分片执行搜索，并生成一个排序的结果列表，该分片列表是本分片的一部分。 每个分片将足够的信息返回给协调节点，以允许其合并并将分片级结果重新排序为size最大长度的全局排序的结果集。

在第二阶段期间，协调节点仅从相关分片请求文档内容（并且高亮显示的片段（如果有））。
</b>

###### 注意

如果你没有在请求中指定search_type，则这是默认设置。

##### Dfs，Query Then Fetch

参数值：dfs_query_then_fetch。

与"Query Then Fetch"相同，除了一个初始散射阶段，它将计算分布式词条频率以获得更准确的得分。

##### Count

###### 警告：在2.0.0-beta1中弃用

对于size为0的query_then_fetch，count不能提供任何好处

参数值：count。

一种特殊的搜索类型，返回与搜索请求匹配的count，而不包含任何文档（以total_hits表示），也可能包括聚合。 一般来说，这是更优于count API，因为它提供了更多的选项。

##### Scan

###### 警告：在2.1.0中弃用

scan不会比由_doc排序的常规scroll请求提供任何好处

参数值：scan。

scan搜索类型禁用排序，以便非常有效地滚动大型结果集。

参考文章：

- https://www.elastic.co/guide/en/elasticsearch/reference/2.4/search-request-search-type.html

